{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":semanticCommits",
    ":timezone(Europe/London)"
  ],

  "prHourlyLimit": 10,
  "labels": ["dependencies", "docker", "renovate"],
  "dependencyDashboard": true,
  "rebaseWhen": "behind-base-branch",
  "rangeStrategy": "replace",

  // Weekly maintenance window: Sundays 03:00â€“05:00 UK time
  "schedule": ["* 3-4 * * 0"],

  "packageRules": [
    {
      "matchDatasources": ["docker"],
      "groupName": "Makefile toolchain images",
      "matchUpdateTypes": ["patch", "minor"],
      "automerge": true,
      "automergeType": "pr",
      "schedule": ["* 3-4 * * 0"]
    }
  ],

  "enabledManagers": ["custom.regex"],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Makefile: variable assignments holding Docker images",
      "managerFilePatterns": ["/^Makefile$/"],
      "matchStrings": [
        // start-of-file OR newline, optional indent, VAR ?= repo/name:TAG
        "(?:^|\\n)[^\\S\\n]*[A-Z0-9_]+\\s*(?:\\?|:)?=\\s*(?<depName>[-\\w./]+):(?<currentValue>v?[0-9]+\\.[0-9]+\\.[0-9]+)\\b"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker"
    },
    {
      "customType": "regex",
      "description": "Makefile: images used directly in docker run lines",
      "managerFilePatterns": ["/^Makefile$/"],
      "matchStrings": [
        // start-of-file OR newline, then a docker run ... repo/name:TAG
        "(?:^|\\n)[\\s\\S]*?docker\\s+run[\\s\\S]*?\\s(?<depName>[-\\w./]+):(?<currentValue>v?[0-9]+\\.[0-9]+\\.[0-9]+)\\b"
      ],
      "datasourceTemplate": "docker",
      "versioningTemplate": "docker"
    }
  ]
}
